/* =========================================================
   CrownTALK â€” Loader Overlay (ULTRA-SMOOTH traces)
   - Long dash segment + long gap (looks nearly continuous)
   - Softer glow, mobile-safe, theme-aware
========================================================= */

/* -------- loader palette -------- */
:root {
  --loader-scrim: rgba(0, 0, 0, 0.55);
  --loader-stroke-bg: rgba(255, 255, 255, 0.12);

  --loader-purple: #a78bfa;
  --loader-blue:   #60a5fa;
  --loader-yellow: #fde047;
  --loader-green:  #34d399;
  --loader-red:    #f87171;

  /* ULTRA-SMOOTH controls */
  --trace-dash: 220;   /* solid segment length */
  --trace-gap:  520;   /* gap length */
  --trace-speed: 2.8s; /* animation speed */
}

[data-theme="dark-purple"] { --loader-scrim: rgba(12, 10, 21, 0.62); --loader-purple: #b6a1ff; }
[data-theme="gold"]   { --loader-scrim: rgba(18, 12, 4, 0.62); }
[data-theme="blue"]   { --loader-scrim: rgba(4, 10, 18, 0.62); }
[data-theme="black"]  { --loader-scrim: rgba(0, 0, 0, 0.65); }
[data-theme="emerald"]{ --loader-scrim: rgba(4, 18, 12, 0.62); }
[data-theme="crimson"]{ --loader-scrim: rgba(22, 6, 9, 0.62); }

/* -------- base overlay -------- */
.chip-loader {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;

  position: fixed;
  inset: 0;
  z-index: 9999;

  display: grid;
  place-items: center;

  padding:
    env(safe-area-inset-top, 0)
    env(safe-area-inset-right, 0)
    env(safe-area-inset-bottom, 0)
    env(safe-area-inset-left, 0);

  background: var(--loader-scrim);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);

  transition: opacity 180ms ease, visibility 0s linear 180ms;
}

body.is-generating .chip-loader {
  visibility: visible;
  opacity: 1;
  pointer-events: all;
  transition: opacity 180ms ease;
}

/* Hide any accidental nested loader */
main .chip-loader { display: none !important; }

/* -------- inner container -------- */
.chip-loader .main-container {
  width: min(92vw, 720px);
  max-height: 90vh;
  display: grid;
  place-items: center;
  pointer-events: none;
}

.chip-loader .loader {
  width: 100%;
  display: grid;
  place-items: center;
}

.chip-loader .loader svg {
  width: min(88vw, 560px);
  max-height: 70vh;
  height: auto;
  object-fit: contain;
  filter: drop-shadow(0 10px 24px rgba(0, 0, 0, 0.35));
  shape-rendering: geometricPrecision;
}

/* -------- SVG strokes (ULTRA-SMOOTH) -------- */
.chip-loader svg .trace-bg {
  fill: none;
  stroke: var(--loader-stroke-bg);
  stroke-width: 5;
  stroke-linecap: round;
}

.chip-loader svg .trace-flow {
  fill: none;
  stroke-width: 5;
  stroke-linecap: round;
  stroke-dasharray: var(--trace-dash) var(--trace-gap);
  animation: chip-dash var(--trace-speed) linear infinite;
  filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.25));
  opacity: 0.95;
}

.chip-loader svg .trace-flow.purple { stroke: var(--loader-purple); }
.chip-loader svg .trace-flow.blue   { stroke: var(--loader-blue); }
.chip-loader svg .trace-flow.yellow { stroke: var(--loader-yellow); }
.chip-loader svg .trace-flow.green  { stroke: var(--loader-green); }
.chip-loader svg .trace-flow.red    { stroke: var(--loader-red); }

/* Slight stagger per color */
.chip-loader svg .trace-flow.blue   { animation-duration: calc(var(--trace-speed) * 1.05); }
.chip-loader svg .trace-flow.green  { animation-duration: calc(var(--trace-speed) * 1.1); }
.chip-loader svg .trace-flow.yellow { animation-duration: calc(var(--trace-speed) * 0.95); }
.chip-loader svg .trace-flow.red    { animation-duration: calc(var(--trace-speed) * 1.12); }

@keyframes chip-dash {
  to { stroke-dashoffset: -1200; }
}

/* Loading text polish */
.chip-loader svg text {
  letter-spacing: 0.6px;
  text-shadow: 0 0 8px rgba(255, 255, 255, 0.12);
}

/* -------- small screens -------- */
@media (max-width: 480px) {
  .chip-loader .loader svg { width: min(92vw, 440px); max-height: 60vh; }
}

/* -------- reduced motion -------- */
@media (prefers-reduced-motion: reduce) {
  .chip-loader { backdrop-filter: none; -webkit-backdrop-filter: none; }
  .chip-loader svg .trace-flow { animation: none; }
}