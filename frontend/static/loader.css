/* =========================================================
   CrownTALK â€” Loader Overlay (mobile-safe, theme-aware)
   - Centers loader on all screen sizes.
   - Uses body.is-generating (already toggled in script.js).
   - If two .chip-loader blocks exist, shows only the one
     directly under <body> and hides the nested one.
========================================================= */

/* -------- loader palette (can tweak per theme if you want) -------- */
:root {
  --loader-scrim: rgba(0, 0, 0, 0.55);
  --loader-stroke-bg: rgba(255, 255, 255, 0.16);

  /* flowing trace colors (SVG paths) */
  --loader-purple: #a78bfa;
  --loader-blue:   #60a5fa;
  --loader-yellow: #fde047;
  --loader-green:  #34d399;
  --loader-red:    #f87171;
}

/* optional: theme-specific nudges */
[data-theme="dark-purple"] {
  --loader-scrim: rgba(12, 10, 21, 0.62);
  --loader-purple: #b6a1ff;
}
[data-theme="gold"]   { --loader-scrim: rgba(18, 12, 4, 0.62); }
[data-theme="blue"]   { --loader-scrim: rgba(4, 10, 18, 0.62); }
[data-theme="black"]  { --loader-scrim: rgba(0, 0, 0, 0.65); }
[data-theme="emerald"]{ --loader-scrim: rgba(4, 18, 12, 0.62); }
[data-theme="crimson"]{ --loader-scrim: rgba(22, 6, 9, 0.62); }

/* -------- base overlay -------- */
.chip-loader {
  /* Hidden by default; revealed when body.is-generating */
  visibility: hidden;
  opacity: 0;
  pointer-events: none;

  position: fixed;
  inset: 0;
  z-index: 9999;

  /* mobile-safe centering */
  display: grid;
  place-items: center;

  /* safe areas for iOS notch/etc */
  padding:
    env(safe-area-inset-top, 0)
    env(safe-area-inset-right, 0)
    env(safe-area-inset-bottom, 0)
    env(safe-area-inset-left, 0);

  background: var(--loader-scrim);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);

  transition: opacity 180ms ease, visibility 0s linear 180ms;
}

/* show overlay while generating */
body.is-generating .chip-loader {
  visibility: visible;
  opacity: 1;
  pointer-events: all;
  transition: opacity 180ms ease;
}

/* If there are two .chip-loader blocks, hide the one nested in <main> */
main .chip-loader { display: none !important; }

/* -------- inner container and content -------- */
.chip-loader .main-container {
  width: min(92vw, 720px);
  max-height: 90vh;

  display: grid;
  place-items: center;
  pointer-events: none; /* block clicks beneath but ignore within */
}

.chip-loader .loader {
  width: 100%;
  display: grid;
  place-items: center;
}

.chip-loader .loader img,
.chip-loader .loader svg {
  width: min(88vw, 560px);
  max-height: 70vh;
  height: auto;
  object-fit: contain;
  filter: drop-shadow(0 10px 24px rgba(0, 0, 0, 0.35));
}

/* -------- Inline SVG animation (your big chip diagram) -------- */
.chip-loader svg .trace-bg {
  fill: none;
  stroke: var(--loader-stroke-bg);
  stroke-width: 6;
  stroke-linecap: round;
}

.chip-loader svg .trace-flow {
  fill: none;
  stroke-width: 6;
  stroke-linecap: round;
  stroke-dasharray: 8 14;
  animation: chip-dash 1.8s linear infinite;
  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.35));
}

.chip-loader svg .trace-flow.purple { stroke: var(--loader-purple); }
.chip-loader svg .trace-flow.blue   { stroke: var(--loader-blue); }
.chip-loader svg .trace-flow.yellow { stroke: var(--loader-yellow); }
.chip-loader svg .trace-flow.green  { stroke: var(--loader-green); }
.chip-loader svg .trace-flow.red    { stroke: var(--loader-red); }

@keyframes chip-dash {
  to { stroke-dashoffset: -200; }
}

/* Slight polish on the "Loading" text inside the SVG */
.chip-loader svg text {
  letter-spacing: 0.6px;
  text-shadow: 0 0 8px rgba(255, 255, 255, 0.12);
}

/* -------- small screens -------- */
@media (max-width: 480px) {
  .chip-loader .loader img,
  .chip-loader .loader svg {
    width: min(92vw, 440px);
    max-height: 60vh;
  }
}

/* -------- accessibility: reduced motion -------- */
@media (prefers-reduced-motion: reduce) {
  .chip-loader { backdrop-filter: none; -webkit-backdrop-filter: none; }
  .chip-loader svg .trace-flow { animation: none; }
}
